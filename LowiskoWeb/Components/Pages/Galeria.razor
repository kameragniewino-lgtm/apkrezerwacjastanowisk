@page "/galeria"
@using LowiskoWeb.Services
@inject BazaDanych Db

<div class="page-galeria">
    <h2>ðŸ“¸ Galeria lowiska</h2>
    <p class="galeria-podtytul">Lowisko Gniewino - Kamera</p>

    <div class="galeria-grid">
        @if (zdjecia.Count == 0)
        {
            <p class="hint" style="grid-column:1/-1;text-align:center;padding:40px 0">Galeria jest pusta. Zdjecia mozna dodac w panelu administratora.</p>
        }
        @foreach (var foto in zdjecia)
        {
            <div class="galeria-item" @onclick="() => Pokaz(foto)">
                <img src="@foto.Url" alt="@foto.Opis" loading="lazy" />
                <div class="galeria-opis">@foto.Opis</div>
            </div>
        }
    </div>
</div>

@if (wybraneFoto != null)
{
    <div class="modal-bg" @onclick="() => wybraneFoto = null">
        <div class="galeria-lightbox" @onclick:stopPropagation="true">
            <img src="@wybraneFoto.Url" alt="@wybraneFoto.Opis" />
            <div class="galeria-lightbox-opis">@wybraneFoto.Opis</div>
            <button class="btn-cancel" @onclick="() => wybraneFoto = null">Zamknij</button>
        </div>
    </div>
}

@code {
    private record Foto(string Url, string Opis);
    private Foto? wybraneFoto;
    private List<Foto> zdjecia = [];
    private void Pokaz(Foto f) => wybraneFoto = f;

    protected override void OnInitialized()
    {
        var zBazy = Db.PobierzGalerie();
        zdjecia = zBazy.Select(z => new Foto(z.Url, z.Opis)).ToList();
    }
}
